<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <!--
      manifest.json provides metadata used when your web app is added to the
      homescreen on Android. See https://developers.google.com/web/fundamentals/engage-and-retain/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico">
    <title>Overworld</title>
  </head>
  <body>
    <noscript>
      You need to enable JavaScript to run this app.
    </noscript>
    
    <div id="loading" data-percent="" />
    
    <canvas id="game" width="240" height="160" />

    <div style="display:none">
      <audio id="intro" class="resource" src="intro.mp3" loop preload="auto"></audio>
      <audio id="overworld" class="resource" src="overworld.mp3" loop preload="auto"></audio>
      <audio id="gamover" class="resource" src="gameover.mp3" loop preload="auto"></audio>
    </div>
    <script>
      let resources = ['webfonts']
          loaded = [];

      WebFontConfig = {
        google: {
            families: ['Press Start 2P']
        },
        active: () => loadedResource('webfonts')
      };
      (function(d) {
        var wf = d.createElement('script'), s = d.scripts[0];
        wf.src = 'https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js';
        wf.async = true;
        s.parentNode.insertBefore(wf, s);
      })(document);

      let loadedResource = (resource) => {
        loaded.push(resource);
        document.getElementById("loading").dataset.percent = loaded.length / resources.length;
      };

      for (let resource of document.getElementsByClassName('resource')) {
        resources.push(resource.id);
        let tag = resource.tagName.toLowerCase();
        let event = tag === 'img' ? 'load' : 'canplay';
        resource.addEventListener(event, () => loadedResource(resource.id));
      }
    </script>
  </body>
</html>
